<!DOCTYPE html>
<html>
    <head>
        <title>Ayarlar</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='settings_style.css') }}">
    </head>
    <body>
    <h1>âš™ï¸ Ayarlar</h1>
    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <label>CPU Alarm EÅŸiÄŸi (%)</label>
        <input type="number" name="cpu" value="{{ config_settings.CPU_THRESHOLD }}" required>

        <label>RAM Alarm EÅŸiÄŸi (%)</label>
        <input type="number" name="ram" value="{{ config_settings.RAM_THRESHOLD }}" required>

        <label>Disk Alarm EÅŸiÄŸi (%)</label>
        <input type="number" name="disk" value="{{ config_settings.DISK_THRESHOLD }}" required>

        <label>E-posta Adresi</label>
        <input type="email" name="email" value="{{ config_settings.EMAIL_RECIPIENT }}" required>

        <label><input type="checkbox" name="alarm" {% if config_settings.ALARM_ENABLED %}checked{% endif %}> Alarm Aktif</label>
        <label><input type="checkbox" name="aggressive" {% if config_settings.AGGRESSIVE_MODE %}checked{% endif %}> Otomatik MÃ¼dahale</label>

        {# GeliÅŸmiÅŸ Ayarlar BaÅŸlÄ±ÄŸÄ± ve Gizlenecek Ä°Ã§erik #}
        <h3 id="advancedSettingsHeader" class="advanced-settings-header">GeliÅŸmiÅŸ Ayarlar</h3>
        <div id="advancedSettingsContent" class="advanced-settings-content">
            <hr> 
            <label>Metrik KayÄ±t AralÄ±ÄŸÄ± (Saniye)</label>
            <input type="number" name="metrics_interval" value="{{ config_settings.METRICS_RECORD_INTERVAL }}" required>

            <label>Anomali AlgÄ±lama Hassasiyeti (0.001 - 0.5 arasÄ±)</label>
            <input type="number" name="anomaly_contamination" step="0.001" min="0.001" max="0.5" value="{{ config_settings.ANOMALY_CONTAMINATION }}" required>

            <label>ML Modeli Min. Ã–rnek SayÄ±sÄ±</label>
            <input type="number" name="min_samples_ml" value="{{ config_settings.MIN_SAMPLES_FOR_ML_CONFIG }}" required>

            <label>RAM Temizleme EÅŸiÄŸi (%)</label>
            <input type="number" name="ram_clean_threshold" value="{{ config_settings.RAM_CLEAN_THRESHOLD }}" required>
            
            <label>Disk Temizleme Doluluk EÅŸiÄŸi (%)</label>
            <input type="number" name="disk_clean_threshold_percent" value="{{ config_settings.DISK_CLEAN_THRESHOLD_PERCENT }}" required>

            <label>Log Tutma SÃ¼resi (GÃ¼n)</label>
            <input type="number" name="log_retention_days" value="{{ config_settings.LOG_RETENTION_DAYS }}" required>

            <div class="form-section">
            <h3>YapÄ±landÄ±rma</h3>

            <div class="form-group">
                <label for="default_network_interface">VarsayÄ±lan AÄŸ ArayÃ¼zÃ¼</label>
                <input type="text" id="default_network_interface" name="default_network_interface" value="{{ config_settings.DEFAULT_NETWORK_INTERFACE }}" required>
                <p class="helper-text">Ä°zlenecek ana aÄŸ kartÄ±nÄ±n adÄ± (Ã¶rn: lo, ens5).</p>
            </div>

            <div class="form-group">
                <label for="anomaly_detection_method">Anomali Tespit YÃ¶ntemi</label>
                <select id="anomaly_detection_method" name="anomaly_detection_method">
                    <option value="threshold" {% if config_settings.get('ANOMALY_DETECTION_METHOD') == 'threshold' %}selected{% endif %}>EÅŸik DeÄŸeri (%)</option>
                    <option value="ml" {% if config_settings.get('ANOMALY_DETECTION_METHOD') == 'ml' %}selected{% endif %}>Makine Ã–ÄŸrenmesi (ML)</option>
                </select>
                <p class="helper-text">ML yÃ¶ntemi, sistemin normal davranÄ±ÅŸÄ±nÄ± Ã¶ÄŸrenerek anomali tespiti yapar.</p>
            </div>
            </div>
            </div>


        <button type="submit">Kaydet</button>
        {# "Test Mail GÃ¶nder" butonu kaldÄ±rÄ±ldÄ± #}
        </form>

    {% if message %}
        <p class="message-feedback {% if 'âŒ' in message %}error{% endif %}">{{ message }}</p>
    {% endif %}

    <hr> 
    <div class="user-management-link"> 
        <a href="{{ url_for('user_management.manage_users') }}" class="btn-navigation">ğŸ‘¥ KullanÄ±cÄ±larÄ± YÃ¶net</a>
    </div>

    <a href="{{ url_for('dashboard.home') }}" class="geri-don-link">â¬… Geri DÃ¶n</a>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.getElementById('advancedSettingsHeader');
            const content = document.getElementById('advancedSettingsContent');

            if (header && content) {
                header.addEventListener('click', function() {
                    content.classList.toggle('show');
                    header.classList.toggle('active');
                });
            } else {
                console.error("Hata: 'advancedSettingsHeader' veya 'advancedSettingsContent' bulunamadÄ±.");
            }
        });
    </script>
    </body>
</html>