<!DOCTYPE html>
    <html lang="tr">
    <head>
        <meta charset="UTF-8">
        <title>Tavsiye ve Cevaplar</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='tavsiye_style.css') }}">
    </head>
    <body>
        <h1>ğŸ’¡ Tavsiye ve Cevaplar</h1>

        {% if message %}
            <p class="message-feedback {% if 'baÅŸarÄ±yla' in message %}success{% else %}error{% endif %}">{{ message }}</p>
        {% endif %}

        {% if not is_admin %}
            <h2>ğŸ’¬ Tavsiyenizi YazÄ±n</h2>
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="mode" value="tavsiye">
                
                <label for="category">Kategori:</label>
                <select id="category" name="category" required>
                    <option value="">Kategori SeÃ§in</option>
                    <option value="Hata Raporu">Hata Raporu</option>
                    <option value="Ozellik Istegi">Ã–zellik Ä°steÄŸi</option>
                    <option value="Genel Geri Bildirim">Genel Geri Bildirim</option>
                    <option value="Performans Sorunu">Performans Sorunu</option>
                    <option value="Diger">DiÄŸer</option>
                </select><br>

                <textarea name="tavsiye" placeholder="Sistem ile ilgili tavsiyenizi yazÄ±n..." required></textarea><br>
                <button type="submit">GÃ¶nder</button>
            </form>
        {% endif %}

        {% if is_admin %}
            <h2>ğŸ“ Gelen Tavsiyeler</h2>
            {% if tavsiyeler %}
                {% for t in tavsiyeler %}
                    <div class="card">
                        <p><strong>{{ t.user }}</strong> - {{ t.timestamp }}</p>
                        <div class="card-details">
                            <span><strong>Durum:</strong> {{ t.status }}</span>
                            <span><strong>Kategori:</strong> {{ t.category or 'BelirtilmemiÅŸ' }}</span>
                            <span><strong>Ã–ncelik:</strong> {{ t.priority }}</span>
                        </div>
                        <p>{{ t.tavsiye }}</p>
                        
                        {# Admin aksiyonlarÄ±: Cevaplama ve Durum/Ã–ncelik GÃ¼ncelleme #}
                        <div class="admin-actions">
                            {# Cevaplama Formu #}
                            <form method="POST">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <input type="hidden" name="mode" value="cevap">
                                <input type="hidden" name="suggestion_id" value="{{ t.id }}">
                                <textarea name="cevap" placeholder="CevabÄ±nÄ±zÄ± yazÄ±n..." required></textarea><br>
                                <button type="submit">ğŸ“© Cevapla</button>
                            </form>

                            {# Durum ve Ã–ncelik GÃ¼ncelleme Formu #}
                            <form method="POST" style="margin-top: 10px;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <input type="hidden" name="mode" value="update_status_priority">
                                <input type="hidden" name="suggestion_id" value="{{ t.id }}">
                                <select name="new_status">
                                    <option value="Yeni" {% if t.status == 'Yeni' %}selected{% endif %}>Yeni</option>
                                    <option value="Inceleniyor" {% if t.status == 'Inceleniyor' %}selected{% endif %}>Ä°nceleniyor</option>
                                    <option value="Cevaplandi" {% if t.status == 'Cevaplandi' %}selected{% endif %}>CevaplandÄ±</option>
                                    <option value="Cozuldu" {% if t.status == 'Cozuldu' %}selected{% endif %}>Ã‡Ã¶zÃ¼ldÃ¼</option>
                                    <option value="Reddedildi" {% if t.status == 'Reddedildi' %}selected{% endif %}>Reddedildi</option>
                                </select>
                                <select name="new_priority">
                                    <option value="Dusuk" {% if t.priority == 'DÃ¼ÅŸÃ¼k' %}selected{% endif %}>DÃ¼ÅŸÃ¼k</option>
                                    <option value="Orta" {% if t.priority == 'Orta' %}selected{% endif %}>Orta</option>
                                    <option value="Yuksek" {% if t.priority == 'YÃ¼ksek' %}selected{% endif %}>YÃ¼ksek</option>
                                </select>
                                <button type="submit">Durum/Ã–ncelik GÃ¼ncelle</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>HenÃ¼z gelen tavsiye bulunmuyor.</p>
            {% endif %}
        {% endif %}

        <h2>ğŸ“¬ Admin CevaplarÄ±</h2>
        {% if cevaplar %}
            {% for c in cevaplar %}
                <div class="card">
                    <p><strong>{{ c.user }}</strong> ({{ c.tavsiye_tarih }})</p>
                    <p>ğŸ“ Tavsiye: {{ c.tavsiye }}</p>
                    <p>ğŸ“© Cevap: {{ c.cevap }}</p>
                    <p>ğŸ“… Cevap Tarihi: {{ c.cevap_tarih }}</p>
                    <div class="actions"> {# CevaplarÄ± silme butonu iÃ§in actions div'i #}
                        <form method="POST" style="display:inline-block;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="mode" value="delete_response">
                            <input type="hidden" name="response_id" value="{{ c.id }}"> {# CevabÄ±n ID'sini gÃ¶nder #}
                            <button type="submit" class="delete-response-btn" onclick="return confirm('Bu cevabÄ± silmek istediÄŸinizden emin misiniz?');">Sil</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>HenÃ¼z cevap yok.</p>
        {% endif %}

        <a href="/">â¬… Geri DÃ¶n</a>
    </body>
    </html>